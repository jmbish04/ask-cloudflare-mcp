<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ask Cloudflare MCP - API & MCP Server</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .section h3 {
            color: #764ba2;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .quick-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .link-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 8px;
            text-decoration: none;
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .link-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .link-card h3 {
            color: white;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .link-card p {
            opacity: 0.9;
            font-size: 0.9em;
        }

        .link-card .icon {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .code-block {
            background: #f5f5f5;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 15px 0;
            position: relative;
        }

        .code-block pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .copy-btn:hover {
            background: #764ba2;
        }

        .endpoint-list {
            list-style: none;
            margin: 20px 0;
        }

        .endpoint-list li {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }

        .endpoint-list .method {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: bold;
            margin-right: 10px;
            font-size: 0.8em;
        }

        .method.get {
            background: #28a745;
            color: white;
        }

        .method.post {
            background: #007bff;
            color: white;
        }

        .method.ws {
            background: #ffc107;
            color: #333;
        }

        .endpoint-list .path {
            font-family: 'Courier New', monospace;
            color: #667eea;
            font-weight: bold;
        }

        .endpoint-list .description {
            display: block;
            margin-top: 8px;
            color: #666;
            font-size: 0.9em;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            text-align: center;
        }

        .feature .icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .feature h4 {
            color: #667eea;
            margin-bottom: 8px;
        }

        .feature p {
            font-size: 0.9em;
            color: #666;
        }

        footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            border-top: 1px solid #ddd;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }

            .quick-links {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸš€ Ask Cloudflare MCP</h1>
            <p>API & MCP Server for Cloudflare Documentation Queries with AI Analysis</p>
        </header>

        <div class="content">
            <!-- Quick Links -->
            <div class="quick-links">
                <a href="/sessions.html" class="link-card">
                    <div class="icon">ğŸ“Š</div>
                    <h3>Session Dashboard</h3>
                    <p>View and manage your API sessions</p>
                </a>

                <a href="/stream-demo.html" class="link-card">
                    <div class="icon">âš¡</div>
                    <h3>Streaming Demo</h3>
                    <p>Real-time terminal-style progress updates</p>
                </a>

                <a href="/swagger" class="link-card">
                    <div class="icon">ğŸ“–</div>
                    <h3>Interactive API Docs</h3>
                    <p>Explore and test endpoints with Swagger UI</p>
                </a>

                <a href="/openapi.json" class="link-card">
                    <div class="icon">ğŸ“‹</div>
                    <h3>OpenAPI Schema</h3>
                    <p>Download the complete API specification</p>
                </a>

                <a href="#examples" class="link-card" onclick="event.preventDefault(); document.getElementById('examples').scrollIntoView({behavior: 'smooth'});">
                    <div class="icon">ğŸ’¡</div>
                    <h3>Usage Examples</h3>
                    <p>See example requests and responses</p>
                </a>

                <a href="#websocket" class="link-card" onclick="event.preventDefault(); document.getElementById('websocket').scrollIntoView({behavior: 'smooth'});">
                    <div class="icon">ğŸ”Œ</div>
                    <h3>WebSocket/MCP</h3>
                    <p>Real-time communication guide</p>
                </a>
            </div>

            <!-- Features -->
            <div class="section">
                <h2>âœ¨ Features</h2>
                <div class="feature-grid">
                    <div class="feature">
                        <div class="icon">ğŸ¤–</div>
                        <h4>AI-Powered</h4>
                        <p>Worker AI analyzes questions and generates follow-ups</p>
                    </div>
                    <div class="feature">
                        <div class="icon">ğŸ“š</div>
                        <h4>CF Docs</h4>
                        <p>Query official Cloudflare documentation via MCP</p>
                    </div>
                    <div class="feature">
                        <div class="icon">ğŸ”—</div>
                        <h4>GitHub</h4>
                        <p>Fetch code context from repositories and analyze PRs</p>
                    </div>
                    <div class="feature">
                        <div class="icon">âš¡</div>
                        <h4>HTTP Streaming</h4>
                        <p>Server-Sent Events with real-time progress updates</p>
                    </div>
                    <div class="feature">
                        <div class="icon">ğŸ”Œ</div>
                        <h4>WebSocket/MCP</h4>
                        <p>Full MCP server support with tools</p>
                    </div>
                    <div class="feature">
                        <div class="icon">ğŸ’¾</div>
                        <h4>Session Tracking</h4>
                        <p>D1 database with Drizzle ORM for full history</p>
                    </div>
                </div>
            </div>

            <!-- API Endpoints -->
            <div class="section">
                <h2>ğŸ”— API Endpoints</h2>
                <ul class="endpoint-list">
                    <li>
                        <span class="method get">GET</span>
                        <span class="path">/api/health</span>
                        <span class="description">Health check endpoint</span>
                    </li>
                    <li>
                        <span class="method post">POST</span>
                        <span class="path">/api/questions/simple</span>
                        <span class="description">Process an array of simple questions</span>
                    </li>
                    <li>
                        <span class="method post">POST</span>
                        <span class="path">/api/questions/detailed</span>
                        <span class="description">Process detailed questions with GitHub code context</span>
                    </li>
                    <li>
                        <span class="method post">POST</span>
                        <span class="path">/api/questions/auto-analyze</span>
                        <span class="description">Auto-analyze GitHub repo, generate questions with AI, cache in KV, and process. Always answers: "Can this repo run on Cloudflare?"</span>
                    </li>
                    <li>
                        <span class="method post">POST</span>
                        <span class="path">/api/questions/pr-analyze</span>
                        <span class="description">ğŸ†• Analyze GitHub PR comments for Cloudflare-specific solutions, generate questions, and get answers</span>
                        <span class="description" style="display:block; margin-top:5px; color:#ffa500;">âš¡ Add <code style="background:#333;padding:2px 6px;border-radius:3px;">?stream=true</code> for real-time progress updates via Server-Sent Events</span>
                    </li>
                    <li>
                        <span class="method get">GET</span>
                        <span class="path">/api/sessions</span>
                        <span class="description">ğŸ†• List all sessions with pagination</span>
                    </li>
                    <li>
                        <span class="method get">GET</span>
                        <span class="path">/api/sessions/:sessionId</span>
                        <span class="description">ğŸ†• Get session details including questions and action logs</span>
                    </li>
                    <li>
                        <span class="method get">GET</span>
                        <span class="path">/api/sessions/:sessionId/download</span>
                        <span class="description">ğŸ†• Download session data as JSON</span>
                    </li>
                    <li>
                        <span class="method get">GET</span>
                        <span class="path">/openapi.json</span>
                        <span class="description">OpenAPI 3.1.0 specification</span>
                    </li>
                    <li>
                        <span class="method get">GET</span>
                        <span class="path">/swagger</span>
                        <span class="description">Swagger UI for interactive API testing</span>
                    </li>
                    <li>
                        <span class="method ws">WS</span>
                        <span class="path">/ws</span>
                        <span class="description">WebSocket for real-time MCP server & API</span>
                    </li>
                </ul>
            </div>

            <!-- Quick Start -->
            <div class="section">
                <h2>ğŸš€ Quick Start</h2>

                <h3>1. Health Check</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre>curl https://your-worker.workers.dev/api/health</pre>
                </div>

                <h3>2. Simple Questions</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre>curl -X POST https://your-worker.workers.dev/api/questions/simple \
  -H "Content-Type: application/json" \
  -d '{
    "questions": [
      "How do I deploy a Hono app to Workers?",
      "What are the best practices for Workers KV?"
    ]
  }'</pre>
                </div>

                <h3>3. OpenAPI Schema (Quick Copy)</h3>
                <p>Copy the OpenAPI schema URL for use in API clients:</p>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre id="openapi-url">https://your-worker.workers.dev/openapi.json</pre>
                </div>
            </div>

            <!-- Examples -->
            <div class="section" id="examples">
                <h2>ğŸ’¡ Usage Examples</h2>

                <h3>Simple Question Request</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre>{
  "questions": [
    "How do I use Durable Objects?",
    "What is the Workers KV API?"
  ]
}</pre>
                </div>

                <h3>Detailed Question Request</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre>{
  "repo_owner": "your-username",
  "repo_name": "your-repo",
  "questions": [{
    "query": "How do I migrate to Cloudflare Pages?",
    "cloudflare_bindings_involved": ["env", "pages"],
    "node_libs_involved": ["webpack", "react"],
    "tags": ["migration", "pages"],
    "relevant_code_files": [{
      "file_path": "webpack.config.js",
      "start_line": 1,
      "end_line": 50,
      "relation_to_question": "Webpack configuration"
    }]
  }]
}</pre>
                </div>

                <h3>ğŸ†• Auto-Analyze Repository Request</h3>
                <p>Automatically analyze a GitHub repository and generate questions:</p>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre>curl -X POST https://your-worker.workers.dev/api/questions/auto-analyze \
  -H "Content-Type: application/json" \
  -d '{
    "repo_url": "https://github.com/your-username/your-repo",
    "force_refresh": false,
    "max_files": 50
  }'</pre>
                </div>

                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre>// Request body
{
  "repo_url": "https://github.com/your-username/your-repo",
  "force_refresh": false,    // Optional: bypass cache
  "max_files": 50            // Optional: limit files analyzed
}

// Response includes:
{
  "repo_url": "https://github.com/your-username/your-repo",
  "repo_owner": "your-username",
  "repo_name": "your-repo",
  "cached": false,
  "questions_generated": 6,
  "questions": [
    {
      "query": "Can the your-repo repository be retrofitted to run on Cloudflare Workers or Pages?",
      "cloudflare_bindings_involved": ["env", "kv", "r2"],
      "node_libs_involved": [],
      "tags": ["feasibility", "migration", "cloudflare"],
      "relevant_code_files": []
    }
    // ... more generated questions
  ],
  "results": [/* Full analysis for each question */],
  "total_processed": 6,
  "timestamp": "2024-11-30T12:00:00.000Z"
}</pre>
                </div>

                <h3>Response Format</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre>{
  "results": [{
    "original_question": "How do I use Durable Objects?",
    "rewritten_question": "What are the steps...",
    "mcp_response": { /* Cloudflare docs response */ },
    "follow_up_questions": ["How do I handle state?"],
    "follow_up_answers": [ /* Follow-up responses */ ],
    "ai_analysis": "Analysis of the response..."
  }],
  "total_processed": 2,
  "timestamp": "2024-11-30T12:00:00.000Z"
}</pre>
                </div>
            </div>

            <!-- WebSocket -->
            <div class="section" id="websocket">
                <h2>ğŸ”Œ WebSocket & MCP Server</h2>
                <p>Connect to the WebSocket endpoint for real-time communication:</p>

                <h3>MCP Server (JSON-RPC 2.0)</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre>// Initialize session
{
  "jsonrpc": "2.0",
  "method": "initialize",
  "params": {
    "protocolVersion": "2024-11-05",
    "clientInfo": {
      "name": "my-client",
      "version": "1.0.0"
    }
  },
  "id": 1
}</pre>
                </div>

                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre>// Query Cloudflare docs
{
  "jsonrpc": "2.0",
  "method": "tools/call",
  "params": {
    "name": "query_cloudflare_docs",
    "arguments": {
      "query": "How do I use Workers AI?",
      "context": "Building a chat application"
    }
  },
  "id": 2
}</pre>
                </div>

                <h3>Real-time API</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre>{
  "type": "question",
  "data": {
    "query": "How do I deploy a Worker?",
    "context": {
      "bindings": ["env", "kv"],
      "libraries": ["hono"]
    }
  }
}</pre>
                </div>
            </div>

            <!-- Architecture -->
            <div class="section">
                <h2>ğŸ—ï¸ Architecture</h2>
                <p>This worker combines multiple services into a unified platform:</p>
                <div class="code-block">
                    <pre>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client/User   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
    â”‚   API    â”‚â—„â”€â”€â”€â”€ REST API (HTTP)
    â”‚    or    â”‚
    â”‚   MCP    â”‚â—„â”€â”€â”€â”€ MCP Server (WebSocket)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Cloudflare Worker (Hono)    â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚  Question Processing   â”‚  â”‚
    â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â”‚
    â”‚      â”‚                â”‚       â”‚
    â”‚  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”‚
    â”‚  â”‚ Worker AIâ”‚    â”‚  MCP   â”‚ â”‚
    â”‚  â”‚          â”‚    â”‚ Client â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚
    â”‚                      â”‚       â”‚
    â”‚                  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”‚
    â”‚                  â”‚ GitHub â”‚ â”‚
    â”‚                  â”‚  API   â”‚ â”‚
    â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>
                </div>
            </div>

            <!-- Setup -->
            <div class="section">
                <h2>âš™ï¸ Setup & Configuration</h2>

                <h3>Required Secrets</h3>
                <p>Set the GitHub token for readonly repository access:</p>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre># Local development
echo "GITHUB_TOKEN=your_github_pat" > .dev.vars

# Production
wrangler secret put GITHUB_TOKEN</pre>
                </div>

                <h3>Create GitHub Token</h3>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>Go to GitHub Settings â†’ Developer settings â†’ Personal access tokens</li>
                    <li>Generate a new token (classic)</li>
                    <li>Select scopes: <code>repo</code> (private) or <code>public_repo</code> (public only)</li>
                    <li>Copy token and set as <code>GITHUB_TOKEN</code> secret</li>
                </ol>
            </div>
        </div>

        <footer>
            <p>Built with â¤ï¸ using Cloudflare Workers, Hono, Worker AI, and MCP</p>
            <p style="margin-top: 10px;">
                <a href="/swagger" style="color: #667eea; text-decoration: none;">Swagger UI</a> â€¢
                <a href="/openapi.json" style="color: #667eea; text-decoration: none;">OpenAPI Spec</a> â€¢
                <a href="https://developers.cloudflare.com/workers/" target="_blank" style="color: #667eea; text-decoration: none;">Cloudflare Docs</a>
            </p>
        </footer>
    </div>

    <script>
        function copyCode(button) {
            const codeBlock = button.parentElement;
            const code = codeBlock.querySelector('pre').textContent;

            navigator.clipboard.writeText(code).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.style.background = '#28a745';

                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '#667eea';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy to clipboard');
            });
        }

        // Update OpenAPI URL to current host
        document.addEventListener('DOMContentLoaded', () => {
            const openapiUrl = document.getElementById('openapi-url');
            if (openapiUrl) {
                openapiUrl.textContent = window.location.origin + '/openapi.json';
            }
        });
    </script>
</body>
</html>
